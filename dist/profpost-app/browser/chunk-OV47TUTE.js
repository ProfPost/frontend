import{a as N,b as j,c as O,d as B,e as $,g as z,h as T}from"./chunk-TX3REZEU.js";import{a as D,b as A,oa as F}from"./chunk-WTALAJB6.js";import{a as f,g as I,h as L,i as w,j as U,k as E,n as l}from"./chunk-TCVV5XCJ.js";import"./chunk-Q64FFBLU.js";import{Db as y,Dc as k,Gc as R,Qb as c,Wa as M,Xb as u,Z as d,da as i,ha as m,lb as S,pb as _,qb as x,xb as a,yb as o,zb as s}from"./chunk-5B7RBOYN.js";var g=class n{isSidebarActive=!1;toggleSidebar(){this.isSidebarActive=!this.isSidebarActive}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=m({type:n,selectors:[["app-reader-layout"]],standalone:!0,features:[u],decls:28,vars:2,consts:[[1,"container-layout"],[1,"sidebar"],[1,"logo"],["src","assets/images/intro-nav/logo.png","alt","Logo"],["routerLink","publications-catalog","routerLinkActive","active"],[1,"fas","fa-home"],["routerLink","subscriptions","routerLinkActive","active"],[1,"fas","fa-shopping-cart"],["routerLink","playlist","routerLinkActive","active"],[1,"fas","fa-play-circle"],["routerLink","search","routerLinkActive","active"],[1,"fas","fa-search"],[1,"main-content"],[1,"sidebar-toggle-btn",3,"click"],[1,"fas","fa-bars"]],template:function(e,r){e&1&&(s(0,"app-navbar"),a(1,"div",0)(2,"div",1)(3,"div",2),s(4,"img",3),o(),a(5,"nav")(6,"ul")(7,"li")(8,"a",4),s(9,"i",5),c(10," Inicio "),o()(),a(11,"li")(12,"a",6),s(13,"i",7),c(14," Suscripciones "),o()(),a(15,"li")(16,"a",8),s(17,"i",9),c(18," Playlist "),o()(),a(19,"li")(20,"a",10),s(21,"i",11),c(22," Buscar "),o()()()()(),a(23,"div",12)(24,"button",13),y("click",function(){return r.toggleSidebar()}),s(25,"i",14),o(),s(26,"router-outlet"),o()(),s(27,"app-footer")),e&2&&(M(2),x("collapsed",!r.isSidebarActive))},dependencies:[R,D,A,L,U,E],styles:["body[_ngcontent-%COMP%]{font-family:Arial,sans-serif;margin:0}.container-layout[_ngcontent-%COMP%]{display:flex;background-color:#e5e8d8}.main-content[_ngcontent-%COMP%]{background-color:#e5e8d8}.sidebar[_ngcontent-%COMP%]{width:200px;height:100vh;background-color:#f8f9f4;padding:20px;box-shadow:2px 0 5px #0000001a;position:fixed;left:0;top:0;transform:translate(0);transition:transform .3s ease;z-index:1000}.sidebar.collapsed[_ngcontent-%COMP%]{transform:translate(-100%)}.sidebar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;display:block;margin:0 auto 20px}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0;margin:0;list-style-type:none}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;padding:10px;font-size:16px;color:#333;cursor:pointer;border-radius:8px;text-decoration:none;transition:background-color .3s}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;margin-right:10px;color:#087443}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#e5e8d8}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#d0e7de;color:#087443}.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:20px;margin-left:200px;transition:margin-left .3s ease}.sidebar.collapsed[_ngcontent-%COMP%] ~ .main-content[_ngcontent-%COMP%]{margin-left:0}.sidebar-toggle-btn[_ngcontent-%COMP%]{position:fixed;top:15px;left:15px;background-color:#087443;color:#fff;border:none;padding:10px;border-radius:4px;cursor:pointer;z-index:1001}.sidebar-toggle-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.sidebar-toggle-btn[_ngcontent-%COMP%]:hover{box-shadow:0 0 5px #087443}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{transform:translate(-100%)}.sidebar.collapsed[_ngcontent-%COMP%]{transform:translate(0)}.main-content[_ngcontent-%COMP%]{margin-left:0}.sidebar-toggle-btn[_ngcontent-%COMP%]{display:block}}"]})};var h=class n{baseURL=`${l.baseURL}/purchases`;http=i(f);createPurchase(t){return this.http.post(this.baseURL,t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};var v=class n{baseURL=`${l.baseURL}/checkout`;http=i(f);createCheckout(t,e,r){let p=`${this.baseURL}/create?purchaseId=${t}&returnUrl=${encodeURIComponent(e)}&cancelUrl=${encodeURIComponent(r)}`;return this.http.post(p,{})}captureOrder(t){let e=`${this.baseURL}/capture?orderId=${t}`;return this.http.post(e,{})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};function J(n,t){n&1&&(a(0,"div",1)(1,"p"),c(2,"Procesando su suscripci\xF3n, por favor espere..."),o()())}var C=class n{subscriptionService=i(N);purchaseService=i(h);checkoutService=i(v);snackBar=i(F);router=i(w);route=i(I);loading=!0;ngOnInit(){this.route.queryParams.subscribe(t=>{let e=t.token;e?this.captureOrder(e):this.initiateSubscription()})}initiateSubscription(){let t=JSON.parse(localStorage.getItem("subscriptionData")||"{}");this.subscriptionService.subscribe(t).subscribe({next:e=>{localStorage.setItem("subscriptionResponse",JSON.stringify(e)),this.createPurchase(e.subscriptionId,e.userId,t.months)},error:()=>{this.loading=!1,alert("Error en la suscripci\xF3n"),this.clearlocalstorage()}})}createPurchase(t,e,r){this.purchaseService.createPurchase({user_id:e,subscription_id:t,months:r}).subscribe({next:p=>{localStorage.setItem("purchaseResponse",JSON.stringify(p)),this.createCheckout(p.id)},error:()=>{this.loading=!1,alert("Error al crear la compra"),this.clearlocalstorage()}})}createCheckout(t){let e=l.paypalReturnUrl,r=l.paypalReturnUrl;this.checkoutService.createCheckout(t,e,r).subscribe({next:p=>{window.location.href=p.paypalUrl,this.loading=!1},error:()=>{this.loading=!1,alert("Error al redirigir a PayPal"),this.clearlocalstorage()}})}captureOrder(t){this.checkoutService.captureOrder(t).subscribe({next:e=>{e.completed?(this.clearlocalstorage(),this.router.navigate(["/reader/subscriptions"]),this.showSnackBar("Felicidades! Est\xE1s suscrito")):(this.router.navigate(["/reader/search"]),this.clearlocalstorage(),this.showSnackBar("Lo sentimos, no pudiste suscribirte :c"))},error:()=>{this.router.navigate(["/reader/search"]),alert("Error al capturar el pedido"),this.showSnackBar("Lo sentimos, no pudiste suscribirte :c"),this.clearlocalstorage()}})}showSnackBar(t){this.snackBar.open(t,"Cerrar",{duration:3e3})}clearlocalstorage(){localStorage.removeItem("selectedUser"),localStorage.removeItem("selectedPlan"),localStorage.removeItem("subscriptionData"),localStorage.removeItem("purchaseResponse"),localStorage.removeItem("subscriptionResponse")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=m({type:n,selectors:[["app-purchases"]],standalone:!0,features:[u],decls:1,vars:1,consts:[["class","loading-screen",4,"ngIf"],[1,"loading-screen"]],template:function(e,r){e&1&&S(0,J,3,0,"div",0),e&2&&_("ngIf",r.loading)},dependencies:[k],styles:[".loading-screen[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#000000b3;color:#fff;font-size:1.5em}"]})};var P=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=m({type:n,selectors:[["app-subscriptions"]],standalone:!0,features:[u],decls:2,vars:0,template:function(e,r){e&1&&(a(0,"p"),c(1,"subscriptions works!"),o())}})};var ke=[{path:"",component:g,children:[{path:"profile",component:O},{path:"profile/update",component:B},{path:"profile/:id",component:O},{path:"publications-catalog",component:T},{path:"playlist",component:$},{path:"subscriptions",component:P},{path:"subscription",component:j},{path:"subscription/checkout",component:C},{path:"search",component:z}]}];export{ke as readerroutes};
